<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; text-align: center; 
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; color: #fff; }

    header { background: transparent; padding: 20px; position: relative; }

    h1 { margin-top: 40px; font-weight: bold; font-size: 36px; text-shadow: 0 0 10px #fff, 0 0 20px #000; }

    p { font-size: 18px; margin-bottom: 30px; }

    form, #form-section {
      margin: 20px auto; max-width: 400px; background: rgba(255,255,255,0.1); padding: 20px;
      border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); backdrop-filter: blur(8px); }

    input { width: 90%; margin: 8px 0; padding: 10px; border-radius: 5px; border: none; outline: none; }

    button { margin-top: 10px; padding: 10px 20px; border: none; background-color: #fff; 
      color: #2575fc; font-weight: bold; border-radius: 5px; cursor: pointer; transition: 0.3s; }

    button:hover { background-color: #2575fc; color: #fff; }

    ul { list-style-type: none; padding: 0; text-align: left; max-width: 600px; margin: 20px auto; }

    li { margin-bottom: 15px; background: rgba(255,255,255,0.15);
      padding: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

    #dark-mode-toggle, #logout-btn { padding: 8px 16px; border: none; border-radius: 5px; 
      background-color: #fff; color: #2575fc; cursor: pointer; font-weight: bold; }

    #dark-mode-toggle { position: absolute; top: 20px; right: 20px; }

    #logout-btn { position: absolute; top: 20px; left: 20px;display: none;}

    body.dark-mode { background: linear-gradient(135deg, #000000 0%, #434343 100%); color: #e0e0e0; }

    body.dark-mode form, body.dark-mode #form-section, body.dark-mode li { background: rgba(0,0,0,0.4); 
      color: #fff; }

    body.dark-mode button { background-color: #2575fc; color: #fff; }

    #app-container { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 30px; }

    #form-section { flex: 1; max-width: 350px; }

    #tasks-output { flex: 1; max-width: 400px; text-align: left; }

    #tasks-output ul { list-style-type: none; padding: 0;}

    #tasks-output li { margin-bottom: 15px; background: rgba(255,255,255,0.15); padding: 12px; 
      border-radius: 8px;box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

  </style>
</head>
<body>
  <header>
    <button id="logout-btn" data-key="logoutBtn">ğŸšª Wyloguj siÄ™</button>
    <button id="dark-mode-toggle" data-key="darkModeBtn">ğŸŒ™ Tryb ciemny</button>
  </header>
  <main>
  <h1 data-key="title">MenedÅ¼er zadaÅ„</h1>
  <p data-key="desc">ZarzÄ…dzaj swoimi zadaniami w prosty sposÃ³b!</p>

  <form id="loginForm">
    <h3 data-key="loginTitle">ğŸ”‘ Logowanie</h3>
    <input id="email" placeholder="Email" data-key="emailPlaceholder">
    <input id="password" type="password" placeholder="HasÅ‚o" data-key="passwordPlaceholder">
    <button type="submit" data-key="loginBtn">Zaloguj</button>
  </form>

  <form id="registerForm">
    <h3 data-key="registerTitle">ğŸ“ Rejestracja</h3>
    <input id="regEmail" placeholder="Email" data-key="emailPlaceholder">
    <input id="regPassword" type="password" placeholder="HasÅ‚o" data-key="passwordPlaceholder">
    <button type="submit" data-key="registerBtn">Zarejestruj</button>
  </form>

  <form id="forgotForm">
    <h3 data-key="forgotTitle">â“ ZapomniaÅ‚eÅ› hasÅ‚a?</h3>
    <input id="forgotEmail" placeholder="Podaj swÃ³j email" data-key="forgotPlaceholder">
    <button type="submit" data-key="forgotBtn">WyÅ›lij link resetujÄ…cy</button>
  </form>

  <div id="app" style="display:none;">
    <div id="app-container">
      <div id="form-section">
        <h3 data-key="addTaskTitle">ğŸ“‹ Dodaj zadanie</h3>
        <input id="task" placeholder="Task" data-key="taskPlaceholder">
        <input id="status" placeholder="Status" data-key="statusPlaceholder">
        <input id="deadline" placeholder="Deadline" data-key="deadlinePlaceholder">
        <button onclick="saveTask()" data-key="addTaskBtn">Dodaj</button>
        <div id="result"></div>
      </div>
      <div id="tasks-output"></div>
    </div>
  </div>

  <div class="controls">
  <button id="language-btn">ğŸŒ Language</button>
  <div id="language-menu" style="display:none;">
    <button data-lang="pl">ğŸ‡µğŸ‡± Polski</button>
    <button data-lang="en">ğŸ‡¬ğŸ‡§ English</button>
    <button data-lang="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
  </div>
</div>
</main>
        <!-- Prawa kolumna: lista taskÃ³w -->
        <div id="tasks-output"></div>
      </div>
    </div>
</main>

<script>
let token = null;

// --- Logowanie
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json();
  if (data.token) {
    token = data.token;
    refreshTasks();
    
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("registerForm").style.display = "none";
    document.getElementById("forgotForm").style.display = "none"; 
    document.getElementById("app").style.display = "block";
    document.getElementById("logout-btn").style.display = "inline-block";
    refreshTasks();
  } else {
    document.getElementById("result").innerHTML = `<p class="success">âœ… Zalogowano poprawnie</p>`;
    document.getElementById("result").innerHTML = `<p class="error">âŒ Logowanie nieudane</p>`;

  }
});

// --- Rejestracja
document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;

  const res = await fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json();
});

// --- Reset Password
document.getElementById("forgotForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("forgotEmail").value;

  const res = await fetch("/forgot-password", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  const data = await res.json();
});
// --- Pobieranie zadaÅ„
async function fetchTasks() {
  const res = await fetch('/api/tasks', {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  return res.json();
}

async function refreshTasks() {
  const tasks = await fetchTasks();
  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');
  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>ğŸ“ ${t.task}</strong><br>ğŸ“Œ ${t.status}<br>â° ${t.deadline}`;
    list.appendChild(li);
  });
  output.appendChild(list);
}

// pokaÅ¼/ukryj menu
document.getElementById("lang-btn").addEventListener("click", () => {
  document.getElementById("lang-menu").style.display =
    document.getElementById("lang-menu").style.display === "block" ? "none" : "block";
});

// --- Dodawanie zadania
async function saveTask() {
  const task = document.getElementById("task").value;
  const status = document.getElementById("status").value;
  const deadline = document.getElementById("deadline").value;

  const res = await fetch('/api/tasks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task, status, deadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}
  async function refreshTasks() {
  const res = await fetch('/api/tasks', {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  const tasks = await res.json();

  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');
  
  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `
      <strong>ğŸ“ ${t.task}</strong><br>
      ğŸ“Œ ${t.status}<br>
      â° ${t.deadline}<br>
      <button onclick="editTask(${t.id})">âœï¸ Edit</button>
      <button onclick="deleteTask(${t.id})">ğŸ—‘ï¸ Delete</button>
  `;
    list.appendChild(li);
  });
  output.appendChild(list);

}
// --- Dodawanie zadania
async function saveTask() {
  const task = document.getElementById("task").value;
  const status = document.getElementById("status").value;
  const deadline = document.getElementById("deadline").value;

  const res = await fetch('/api/tasks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task, status, deadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;

  // --- czyÅ›cimy pola po dodaniu
  document.getElementById("task").value = "";
  document.getElementById("status").value = "";
  document.getElementById("deadline").value = "";

  refreshTasks();
}

// --- Usuwanie zadania
async function deleteTask(id) {
  const res = await fetch(`/api/tasks/${id}`, {
    method: 'DELETE',
    headers: { 'Authorization': 'Bearer ' + token }
  });
  const data = await res.json();
  refreshTasks();
}

async function updateTask(id) {
  const newTask = document.getElementById(`task-${id}`).value;
  const newStatus = document.getElementById(`status-${id}`).value;
  const newDeadline = document.getElementById(`deadline-${id}`).value;

  const res = await fetch(`/api/tasks/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task: newTask, status: newStatus, deadline: newDeadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}

function startEdit(id, task, status, deadline) {
  document.getElementById(`view-${id}`).style.display = "none";
  document.getElementById(`edit-${id}`).style.display = "block";
}

function cancelEdit(id) {
  document.getElementById(`edit-${id}`).style.display = "none";
  document.getElementById(`view-${id}`).style.display = "block";
}

async function saveEdit(id) {
  const newTask = document.getElementById(`edit-task-${id}`).value;
  const newStatus = document.getElementById(`edit-status-${id}`).value;
  const newDeadline = document.getElementById(`edit-deadline-${id}`).value;

  const res = await fetch(`/api/tasks/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task: newTask, status: newStatus, deadline: newDeadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}

async function refreshTasks() {
  const tasks = await fetchTasks();
  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');

  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div id="view-${t.id}">
        <strong>ğŸ“ ${t.task}</strong><br>
        ğŸ“Œ ${t.status}<br>
        â° ${t.deadline}<br>
        <button data-key="editBtn" onclick="startEdit(${t.id}, '${t.task}', '${t.status}', '${t.deadline}')">âœï¸ Edytuj</button>
        <button data-key="deleteBtn" onclick="deleteTask(${t.id})">ğŸ—‘ï¸ UsuÅ„</button>
      </div>
      <div id="edit-${t.id}" style="display:none;">
        <input type="text" id="edit-task-${t.id}" value="${t.task}" />
        <input type="text" id="edit-status-${t.id}" value="${t.status}" />
        <input type="text" id="edit-deadline-${t.id}" value="${t.deadline}" />
        <button data-key="saveBtn" onclick="saveEdit(${t.id})">ğŸ’¾ Zapisz</button>
        <button data-key="cancelBtn" onclick="cancelEdit(${t.id})">âŒ Anuluj</button>
      </div>
    `;
    list.appendChild(li);
  });

  output.appendChild(list);
} 
translatePage(currentLang);

</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- TRANSLATIONS (tylko raz, peÅ‚ne)
  const translations = {
    pl: {
      title: "MenedÅ¼er zadaÅ„",
      desc: "ZarzÄ…dzaj swoimi zadaniami w prosty sposÃ³b!",
      loginTitle: "ğŸ”‘ Logowanie",
      emailPlaceholder: "Email",
      passwordPlaceholder: "HasÅ‚o",
      loginBtn: "Zaloguj",
      registerTitle: "ğŸ“ Rejestracja",
      registerBtn: "Zarejestruj",
      forgotTitle: "â“ ZapomniaÅ‚eÅ› hasÅ‚a?",
      forgotPlaceholder: "Podaj swÃ³j email",
      forgotBtn: "WyÅ›lij link resetujÄ…cy",
      addTaskTitle: "ğŸ“‹ Dodaj zadanie",
      taskPlaceholder: "Zadanie",
      statusPlaceholder: "Status",
      deadlinePlaceholder: "Termin",
      addTaskBtn: "Dodaj",
      logoutBtn: "ğŸšª Wyloguj",
      darkModeOn: "ğŸŒ™ Tryb ciemny",
      darkModeOff: "â˜€ï¸ Tryb jasny",
      saveBtn: "ğŸ’¾ Zapisz",
      cancelBtn: "âŒ Anuluj",
      editBtn: "âœï¸ Edytuj",
      deleteBtn: "ğŸ—‘ï¸ UsuÅ„"
    },
    en: {
      title: "Task Manager",
      desc: "Manage your tasks easily!",
      loginTitle: "ğŸ”‘ Login",
      emailPlaceholder: "Email",
      passwordPlaceholder: "Password",
      loginBtn: "Log in",
      registerTitle: "ğŸ“ Register",
      registerBtn: "Sign up",
      forgotTitle: "â“ Forgot your password?",
      forgotPlaceholder: "Enter your email",
      forgotBtn: "Send reset link",
      addTaskTitle: "ğŸ“‹ Add task",
      taskPlaceholder: "Task",
      statusPlaceholder: "Status",
      deadlinePlaceholder: "Deadline",
      addTaskBtn: "Add",
      logoutBtn: "ğŸšª Log out",
      darkModeOn: "ğŸŒ™ Dark Mode",
      darkModeOff: "â˜€ï¸ Light Mode",
      saveBtn: "ğŸ’¾ Save",
      cancelBtn: "âŒ Cancel",
      editBtn: "âœï¸ Edit",
      deleteBtn: "ğŸ—‘ï¸ Delete"
    },
    es: {
      title: "Gestor de tareas",
      desc: "Â¡Administra tus tareas fÃ¡cilmente!",
      loginTitle: "ğŸ”‘ Iniciar sesiÃ³n",
      emailPlaceholder: "Correo electrÃ³nico",
      passwordPlaceholder: "ContraseÃ±a",
      loginBtn: "Entrar",
      registerTitle: "ğŸ“ Registro",
      registerBtn: "Registrarse",
      forgotTitle: "â“ Â¿Olvidaste tu contraseÃ±a?",
      forgotPlaceholder: "Introduce tu correo",
      forgotBtn: "Enviar enlace",
      addTaskTitle: "ğŸ“‹ AÃ±adir tarea",
      taskPlaceholder: "Tarea",
      statusPlaceholder: "Estado",
      deadlinePlaceholder: "Fecha lÃ­mite",
      addTaskBtn: "AÃ±adir",
      logoutBtn: "ğŸšª Cerrar sesiÃ³n",
      darkModeOn: "ğŸŒ™ Modo oscuro",
      darkModeOff: "â˜€ï¸ Modo claro",
      saveBtn: "ğŸ’¾ Guardar",
      cancelBtn: "âŒ Cancelar",
      editBtn: "âœï¸ Editar",
      deleteBtn: "ğŸ—‘ï¸ Eliminar"
    }
  };

  // --- DOM refs (bez zgadywania nazw)
  const languageBtn = document.getElementById('language-btn');
  const languageMenu = document.getElementById('language-menu');
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const logoutBtn = document.getElementById('logout-btn');

  // --- LANGUAGE: stan i tÅ‚umaczenie
  const savedLang = localStorage.getItem('lang') || 'pl';

  function translatePage(lang) {
    document.querySelectorAll('[data-key]').forEach(el => {
      const key = el.getAttribute('data-key');
      const translation = translations[lang] && translations[lang][key];
      if (!translation) return;
      const tag = el.tagName.toUpperCase();
      if (tag === 'INPUT' || tag === 'TEXTAREA') {
        el.placeholder = translation;
      } else {
        el.textContent = translation;
      }
    });
    // Uaktualnij label przycisku jÄ™zyka
    if (languageBtn) {
      const label = lang === 'pl' ? 'Polish' : lang === 'en' ? 'English' : 'EspaÃ±ol';
      languageBtn.textContent = `ğŸŒ Language: ${label}`;
    }
    localStorage.setItem('lang', lang);
  }

  // pokaÅ¼/ukryj menu jÄ™zykowe
  if (languageBtn && languageMenu) {
    languageBtn.addEventListener('click', () => {
      languageMenu.style.display = languageMenu.style.display === 'block' ? 'none' : 'block';
    });

    languageMenu.querySelectorAll('button[data-lang]').forEach(btn => {
      btn.addEventListener('click', () => {
        const lang = btn.dataset.lang;
        translatePage(lang);
        languageMenu.style.display = 'none';
      });
    });
  }
// --- Dark mode/Light mode
let currentLang = "pl";

function updateDarkModeButton() {
  const btn = document.getElementById("dark-mode-toggle");
  const isDark = document.body.classList.contains("dark-mode");
  const key = isDark ? "darkModeOff" : "darkModeOn";
  btn.setAttribute("data-key", key);
  btn.textContent = translations[currentLang][key];
}

document.getElementById("dark-mode-toggle").addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
  updateDarkModeButton();
});
function applyDarkModeState(state) {
    if (state === "dark") {
      document.body.classList.add("dark-mode");
    } else {
      document.body.classList.remove("dark-mode");
    }
    updateDarkModeButton();
  }
  


// Funkcja tÅ‚umaczÄ…ca caÅ‚Ä… stronÄ™
function translatePage(lang) {
  currentLang = lang;
  document.querySelectorAll("[data-key]").forEach(el => {
    const key = el.getAttribute("data-key");
    const translation = translations[lang][key];
    if (!translation) return;
    if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
      el.placeholder = translation;
    } else {
      el.textContent = translation;
    }
  });
  updateDarkModeButton(); // odÅ›wieÅ¼ tekst przycisku Dark Mode
}

  // --- LOGOUT: jedna, bez duplikatÃ³w (dziaÅ‚a, ale nie rusza logowania)
  if (logoutBtn) {
    logoutBtn.addEventListener('click', () => {
      // JeÅ›li uÅ¼ywasz globalnego tokena i/lub localStorage:
      try { localStorage.removeItem('token'); } catch {}
      // UI reset
      const app = document.getElementById('app');
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');

      if (app) app.style.display = 'none';
      if (loginForm) loginForm.style.display = 'block';
      if (registerForm) registerForm.style.display = 'block';
      logoutBtn.style.display = 'none';

      ['email','password','regEmail','regPassword'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
    });
  }

  // --- INIT: zastosuj zapisane ustawienia przy starcie
  translatePage(savedLang);
  translatePage("pl");
  applyDarkModeState(savedDark);
});
</script>
</body>
</html>
