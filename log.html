<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Task Manager</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; text-align: center; 
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); min-height: 100vh; color: #fff; }

    header { background: transparent; padding: 20px; position: relative; }

    h1 { margin-top: 40px; font-weight: bold; font-size: 36px; text-shadow: 0 0 10px #fff, 0 0 20px #000; }

    p { font-size: 18px; margin-bottom: 30px; }

    form, #form-section {
      margin: 20px auto; max-width: 400px; background: rgba(255,255,255,0.1); padding: 20px;
      border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); backdrop-filter: blur(8px); }

    input { width: 90%; margin: 8px 0; padding: 10px; border-radius: 5px; border: none; outline: none; }

    button { margin-top: 10px; padding: 10px 20px; border: none; background-color: #fff; 
      color: #2575fc; font-weight: bold; border-radius: 5px; cursor: pointer; transition: 0.3s; }

    button:hover { background-color: #2575fc; color: #fff; }

    ul { list-style-type: none; padding: 0; text-align: left; max-width: 600px; margin: 20px auto; }

    li { margin-bottom: 15px; background: rgba(255,255,255,0.15);
      padding: 12px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

    #dark-mode-toggle, #logout-btn { padding: 8px 16px; border: none; border-radius: 5px; 
      background-color: #fff; color: #2575fc; cursor: pointer; font-weight: bold; }

    #dark-mode-toggle { position: absolute; top: 20px; right: 20px; }

    #logout-btn { position: absolute; top: 20px; left: 20px;display: none;}

    body.dark-mode { background: linear-gradient(135deg, #000000 0%, #434343 100%); color: #e0e0e0; }

    body.dark-mode form, body.dark-mode #form-section, body.dark-mode li { background: rgba(0,0,0,0.4); 
      color: #fff; }

    body.dark-mode button { background-color: #2575fc; color: #fff; }

    #app-container { display: flex; justify-content: space-around; align-items: flex-start; margin-top: 30px; }

    #form-section { flex: 1; max-width: 350px; }

    #tasks-output { flex: 1; max-width: 400px; text-align: left; }

    #tasks-output ul { list-style-type: none; padding: 0;}

    #tasks-output li { margin-bottom: 15px; background: rgba(255,255,255,0.15); padding: 12px; 
      border-radius: 8px;box-shadow: 0 2px 6px rgba(0,0,0,0.2); }

  </style>
</head>
<body>
  <header>
    <button id="logout-btn">ğŸšª Log out</button>
    <button id="dark-mode-toggle">ğŸŒ™ Dark Mode</button>
  </header>

  <main>
    <h1>Task Manager</h1>
    <p>ZarzÄ…dzaj swoimi zadaniami w prosty sposÃ³b!</p>

    <!-- Formularze -->
    <form id="loginForm">
      <h3>ğŸ”‘ Logowanie</h3>
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="HasÅ‚o" required>
      <button type="submit">Zaloguj</button>
    </form>

    <form id="registerForm">
      <h3>ğŸ“ Rejestracja</h3>
      <input type="email" id="regEmail" placeholder="Email" required>
      <input type="password" id="regPassword" placeholder="HasÅ‚o" required>
      <button type="submit">Zarejestruj</button>
    </form>
    <!-- Sekcja zadaÅ„ -->
    <div id="app" style="display:none;">
      <div id="app-container">
        <!-- Lewa kolumna: formularz -->
        <div id="form-section">
          <h3>ğŸ“‹ Dodaj zadanie</h3>
          <input id="task" placeholder="Task">
          <input id="status" placeholder="Status">
          <input id="deadline" placeholder="Deadline">
          <button onclick="saveTask()">Dodaj</button>
          <div id="result"></div>
        </div>

        <!-- Prawa kolumna: lista taskÃ³w -->
        <div id="tasks-output"></div>
      </div>
    </div>
  </main>

<script>
let token = null;

// --- Logowanie
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json();
  if (data.token) {
    token = data.token;
    document.getElementById("loginForm").style.display = "none";
    document.getElementById("registerForm").style.display = "none";
    document.getElementById("app").style.display = "block";
    document.getElementById("logout-btn").style.display = "inline-block";
    refreshTasks();
  } else {
    alert(data.message || "âŒ Logowanie nieudane");
  }
});

// --- Rejestracja
document.getElementById("registerForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("regEmail").value;
  const password = document.getElementById("regPassword").value;

  const res = await fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, password })
  });

  const data = await res.json();
  alert(data.message);
});

// --- Pobieranie zadaÅ„
async function fetchTasks() {
  const res = await fetch('/api/tasks', {
    headers: { 'Authorization': 'Bearer ' + token }
  });
  return res.json();
}

async function refreshTasks() {
  const tasks = await fetchTasks();
  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');
  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `<strong>ğŸ“ ${t.task}</strong><br>ğŸ“Œ ${t.status}<br>â° ${t.deadline}`;
    list.appendChild(li);
  });
  output.appendChild(list);
}

// --- Dodawanie zadania
async function saveTask() {
  const task = document.getElementById("task").value;
  const status = document.getElementById("status").value;
  const deadline = document.getElementById("deadline").value;

  const res = await fetch('/api/tasks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task, status, deadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}
async function refreshTasks() {
  const tasks = await fetchTasks();
  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');
  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `
      <strong>ğŸ“ ${t.task}</strong><br>
      ğŸ“Œ ${t.status}<br>
      â° ${t.deadline}<br>
      <button onclick="editTask(${t.id})">âœï¸ Edit</button>
      <button onclick="deleteTask(${t.id})">ğŸ—‘ï¸ Delete</button>
    `;
    list.appendChild(li);
  });
  output.appendChild(list);
}
// --- Dodawanie zadania
async function saveTask() {
  const task = document.getElementById("task").value;
  const status = document.getElementById("status").value;
  const deadline = document.getElementById("deadline").value;

  const res = await fetch('/api/tasks', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task, status, deadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;

  // --- czyÅ›cimy pola po dodaniu
  document.getElementById("task").value = "";
  document.getElementById("status").value = "";
  document.getElementById("deadline").value = "";

  refreshTasks();
}

// --- Usuwanie zadania
async function deleteTask(id) {
  const res = await fetch(`/api/tasks/${id}`, {
    method: 'DELETE',
    headers: { 'Authorization': 'Bearer ' + token }
  });
  const data = await res.json();
  alert(data.message);
  refreshTasks();
}

async function updateTask(id) {
  const newTask = document.getElementById(`task-${id}`).value;
  const newStatus = document.getElementById(`status-${id}`).value;
  const newDeadline = document.getElementById(`deadline-${id}`).value;

  const res = await fetch(`/api/tasks/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task: newTask, status: newStatus, deadline: newDeadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}

function startEdit(id, task, status, deadline) {
  document.getElementById(`view-${id}`).style.display = "none";
  document.getElementById(`edit-${id}`).style.display = "block";
}

function cancelEdit(id) {
  document.getElementById(`edit-${id}`).style.display = "none";
  document.getElementById(`view-${id}`).style.display = "block";
}

async function saveEdit(id) {
  const newTask = document.getElementById(`edit-task-${id}`).value;
  const newStatus = document.getElementById(`edit-status-${id}`).value;
  const newDeadline = document.getElementById(`edit-deadline-${id}`).value;

  const res = await fetch(`/api/tasks/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + token
    },
    body: JSON.stringify({ task: newTask, status: newStatus, deadline: newDeadline })
  });

  const data = await res.json();
  document.getElementById("result").textContent = data.message;
  refreshTasks();
}

async function refreshTasks() {
  const tasks = await fetchTasks();
  const output = document.getElementById('tasks-output');
  output.innerHTML = '';
  const list = document.createElement('ul');

  tasks.forEach(t => {
    const li = document.createElement('li');
    li.innerHTML = `
      <div id="view-${t.id}">
        <strong>ğŸ“ ${t.task}</strong><br>
        ğŸ“Œ ${t.status}<br>
        â° ${t.deadline}<br>
        <button onclick="startEdit(${t.id}, '${t.task}', '${t.status}', '${t.deadline}')">âœï¸ Edit</button>
        <button onclick="deleteTask(${t.id})">ğŸ—‘ï¸ Delete</button>
      </div>
      <div id="edit-${t.id}" style="display:none;">
        <input type="text" id="edit-task-${t.id}" value="${t.task}" />
        <input type="text" id="edit-status-${t.id}" value="${t.status}" />
        <input type="text" id="edit-deadline-${t.id}" value="${t.deadline}" />
        <button onclick="saveEdit(${t.id})">ğŸ’¾ Save</button>
        <button onclick="cancelEdit(${t.id})">âŒ Cancel</button>
      </div>
    `;
    list.appendChild(li);
  });

  output.appendChild(list);
}

// --- Dark Mode toggle
document.getElementById("dark-mode-toggle").addEventListener("click", function() {
  document.body.classList.toggle("dark-mode");
  this.textContent = document.body.classList.contains("dark-mode") ? "â˜€ï¸ Light Mode" : "ğŸŒ™ Dark Mode";
});

document.getElementById("logout-btn").addEventListener("click", () => {
  token = null;
  document.getElementById("app").style.display = "none";
  document.getElementById("loginForm").style.display = "block";
  document.getElementById("registerForm").style.display = "block";
  document.getElementById("logout-btn").style.display = "none";

  // --- czyÅ›cimy formularze przy wylogowaniu
  document.getElementById("email").value = "";
  document.getElementById("password").value = "";
  document.getElementById("regEmail").value = "";
  document.getElementById("regPassword").value = "";
});

// --- Log out
document.getElementById("logout-btn").addEventListener("click", () => {
  token = null;
  document.getElementById("app").style.display = "none";
  document.getElementById("loginForm").style.display = "block";
  document.getElementById("registerForm").style.display = "block";
  document.getElementById("logout-btn").style.display = "none";
});
</script>
</body>
</html>
